{
  "name": "apache-kafka",
  "category": "middleware",
  "namespace": "default",
  "compute": {
    "vms": [
      {
        "name": "xpanse-kafka-vm",
        "type": "m1.medium",
        "imageId": "3519889b-25ed-4d1a-a893-8563d5d005a9",
        "subnets": [
          "external"
        ],
        "publicly": false,
        "userData": {
          "type": "shell",
          "commands": [
            "echo \"sslverify=0\" >> /etc/yum.conf",
            "curl -fsSLk https://get.docker.com -o get-docker.sh",
            "sh get-docker.sh",
            "sudo systemctl start docker",
            "docker network create app-tier --driver bridge",
            "docker run -d --name zookeeper-server --network app-tier -e ALLOW_ANONYMOUS_LOGIN=yes bitnami/zookeeper:latest",
            "docker run -d --name kafka-server --network app-tier -e ALLOW_PLAINTEXT_LISTENER=yes -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper-server:2181 bitnami/kafka:latest",
            "docker ps",
            "echo \"Kafka up and running\""
          ]
        }
      }
    ]
  },
  "network": {
    "subnets": [
      {
        "name": "external",
        "vpc": "default",
        "cidr": "10.20.20.0/24"
      }
    ]
  }
}
